# 路由系统迁移计划

## 当前状态

目前，该项目混合使用了 Next.js 的两种路由系统：

1. **Pages Router** (旧版)
   - 位于 `src/pages` 目录
   - 主要用于 `_app.tsx` 全局封装组件

2. **App Router** (新版)
   - 位于 `src/app` 目录
   - 包含应用的主要路由和 API 端点

## 迁移目标

将项目完全迁移到 App Router 系统，以获取 Next.js 的所有最新功能和性能改进。

## 迁移步骤

### 阶段一：准备工作（已完成）

1. ✅ 创建路由兼容层 (`src/lib/routing.ts`)
2. ✅ 统一 API 服务和类型定义
3. ✅ 重构组件目录结构

### 阶段二：迁移全局布局

1. 将 `_app.tsx` 中的全局样式和组件迁移到 `app/layout.tsx`
   - 迁移全局样式和主题设置
   - 迁移全局上下文提供者
   - 迁移全局错误处理

2. 确保全局状态管理与 App Router 兼容

### 阶段三：删除 Pages Router 依赖

1. 完全删除 `src/pages` 目录
2. 更新所有组件中的导入，确保使用 App Router 组件 
3. 更新所有路由相关代码，使用 `useRouter` 而不是旧版的 `useRouter`

### 阶段四：优化 App Router 结构

1. 实现加载状态优化，利用 Next.js 14+ 的 Suspense 功能
2. 添加错误处理边界
3. 实现服务器组件与客户端组件的合理分离

## 测试策略

1. 为每个迁移步骤创建独立的分支
2. 针对每个页面运行端到端测试，确保功能正常
3. 优先迁移复杂度较低的页面，逐渐过渡到复杂页面

## 注意事项

1. App Router 使用的是 React 服务器组件，可能需要调整部分使用了客户端功能的组件
2. 一些生命周期方法在服务器组件中工作方式不同，需要调整
3. 数据获取方法会有显著变化，从 `getServerSideProps` 转向 React 服务器组件内的直接数据获取
